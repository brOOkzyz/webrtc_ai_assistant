[2025-08-21 15:17:18,996] [INFO] ✅ 信号处理器设置完成
[2025-08-21 15:17:18,996] [INFO] 🔧 服务器管理器初始化完成
[2025-08-21 15:17:18,996] [INFO] 🔍 开始验证运行环境...
[2025-08-21 15:17:18,997] [INFO] ✅ 运行环境验证通过
[2025-08-21 15:17:18,997] [INFO] 🚀 正在启动WebRTC语音助手服务器...
[2025-08-21 15:17:18,997] [INFO] 🚀 正在启动WebRTC服务器 localhost:8765
[2025-08-21 15:17:19,006] [INFO] server listening on 127.0.0.1:8765
[2025-08-21 15:17:19,006] [INFO] server listening on [::1]:8765
[2025-08-21 15:17:19,006] [INFO] ✅ WebRTC服务器启动成功！
[2025-08-21 15:17:19,006] [INFO] 📍 监听地址: localhost:8765
[2025-08-21 15:17:19,006] [INFO] 💡 客户端可通过 webrtc_client.html 连接
[2025-08-21 15:17:19,006] [INFO] 🔄 等待客户端连接...
[2025-08-21 15:17:27,593] [INFO] connection open
[2025-08-21 15:17:27,593] [ERROR] connection handler failed
Traceback (most recent call last):
  File "/Users/brookz/.pyenv/versions/3.10.14/lib/python3.10/site-packages/websockets/asyncio/server.py", line 376, in conn_handler
    await self.handler(connection)
TypeError: WebRTCServer.handle_client() missing 1 required positional argument: 'path'
[2025-08-21 15:17:32,896] [INFO] 🛑 收到信号: SIGINT
[2025-08-21 15:17:32,897] [INFO] 🛑 正在关闭服务器...
[2025-08-21 15:17:32,897] [INFO] ✅ 服务器已关闭
[2025-08-21 15:17:32,898] [INFO] server closing
[2025-08-21 15:17:32,898] [INFO] server closed
[2025-08-21 15:17:32,898] [INFO] 🛑 服务器运行被取消
[2025-08-21 15:17:32,898] [INFO] ✅ 服务器运行完成
[2025-08-21 15:18:36,985] [INFO] ✅ 信号处理器设置完成
[2025-08-21 15:18:36,986] [INFO] 🔧 服务器管理器初始化完成
[2025-08-21 15:18:36,986] [INFO] 🔍 开始验证运行环境...
[2025-08-21 15:18:36,987] [INFO] ✅ 运行环境验证通过
[2025-08-21 15:18:36,987] [INFO] 🚀 正在启动WebRTC语音助手服务器...
[2025-08-21 15:18:36,987] [INFO] 🚀 正在启动WebRTC服务器 localhost:8765
[2025-08-21 15:18:36,995] [INFO] server listening on 127.0.0.1:8765
[2025-08-21 15:18:36,995] [INFO] server listening on [::1]:8765
[2025-08-21 15:18:36,995] [INFO] ✅ WebRTC服务器启动成功！
[2025-08-21 15:18:36,995] [INFO] 📍 监听地址: localhost:8765
[2025-08-21 15:18:36,995] [INFO] 💡 客户端可通过 webrtc_client.html 连接
[2025-08-21 15:18:36,995] [INFO] 🔄 等待客户端连接...
[2025-08-21 15:18:50,232] [INFO] connection open
[2025-08-21 15:18:50,232] [ERROR] connection handler failed
Traceback (most recent call last):
  File "/Users/brookz/.pyenv/versions/3.10.14/lib/python3.10/site-packages/websockets/asyncio/server.py", line 376, in conn_handler
    await self.handler(connection)
TypeError: WebRTCServer.handle_client() missing 1 required positional argument: 'path'
[2025-08-21 15:18:54,439] [INFO] 🛑 收到信号: SIGINT
[2025-08-21 15:18:54,452] [INFO] 🛑 正在关闭服务器...
[2025-08-21 15:18:54,455] [INFO] ✅ 服务器已关闭
[2025-08-21 15:18:54,456] [INFO] 🛑 服务器运行被取消
[2025-08-21 15:18:54,456] [INFO] ✅ 服务器运行完成
[2025-08-21 15:19:15,365] [INFO] ✅ 信号处理器设置完成
[2025-08-21 15:19:15,365] [INFO] 🔧 服务器管理器初始化完成
[2025-08-21 15:19:15,365] [INFO] 🔍 开始验证运行环境...
[2025-08-21 15:19:15,367] [INFO] ✅ 运行环境验证通过
[2025-08-21 15:19:15,367] [INFO] 🚀 正在启动WebRTC语音助手服务器...
[2025-08-21 15:19:15,367] [INFO] 🚀 正在启动WebRTC服务器 localhost:8765
[2025-08-21 15:19:15,375] [INFO] server listening on 127.0.0.1:8765
[2025-08-21 15:19:15,375] [INFO] server listening on [::1]:8765
[2025-08-21 15:19:15,375] [INFO] ✅ WebRTC服务器启动成功！
[2025-08-21 15:19:15,375] [INFO] 📍 监听地址: localhost:8765
[2025-08-21 15:19:15,375] [INFO] 💡 客户端可通过 webrtc_client.html 连接
[2025-08-21 15:19:15,375] [INFO] 🔄 等待客户端连接...
[2025-08-21 15:19:28,704] [INFO] connection open
[2025-08-21 15:19:28,704] [ERROR] connection handler failed
Traceback (most recent call last):
  File "/Users/brookz/.pyenv/versions/3.10.14/lib/python3.10/site-packages/websockets/asyncio/server.py", line 376, in conn_handler
    await self.handler(connection)
TypeError: WebRTCServer.start.<locals>.handler() missing 1 required positional argument: 'path'
[2025-08-21 15:19:34,126] [INFO] 🛑 收到信号: SIGINT
[2025-08-21 15:19:34,127] [INFO] 🛑 正在关闭服务器...
[2025-08-21 15:19:34,127] [INFO] ✅ 服务器已关闭
[2025-08-21 15:19:34,127] [INFO] 🛑 服务器运行被取消
[2025-08-21 15:19:34,127] [INFO] ✅ 服务器运行完成
[2025-08-21 15:20:06,269] [INFO] ✅ 信号处理器设置完成
[2025-08-21 15:20:06,269] [INFO] 🔧 服务器管理器初始化完成
[2025-08-21 15:20:06,269] [INFO] 🔍 开始验证运行环境...
[2025-08-21 15:20:06,270] [INFO] ✅ 运行环境验证通过
[2025-08-21 15:20:06,270] [INFO] 🚀 正在启动WebRTC语音助手服务器...
[2025-08-21 15:20:06,270] [INFO] 🚀 正在启动WebRTC服务器 localhost:8765
[2025-08-21 15:20:06,275] [INFO] server listening on [::1]:8765
[2025-08-21 15:20:06,276] [INFO] server listening on 127.0.0.1:8765
[2025-08-21 15:20:06,276] [INFO] ✅ WebRTC服务器启动成功！
[2025-08-21 15:20:06,276] [INFO] 📍 监听地址: localhost:8765
[2025-08-21 15:20:06,276] [INFO] 💡 客户端可通过 webrtc_client.html 连接
[2025-08-21 15:20:06,276] [INFO] 🔄 等待客户端连接...
[2025-08-21 15:20:15,131] [INFO] connection open
[2025-08-21 15:20:15,132] [INFO] 🔌 新客户端连接: 46cbd5c5-f087-4690-ada7-24294fdc09b1
[2025-08-21 15:20:28,998] [INFO] 🛑 收到信号: SIGINT
[2025-08-21 15:20:28,998] [INFO] 🛑 正在关闭服务器...
[2025-08-21 15:20:28,999] [INFO] ✅ 服务器已关闭
[2025-08-21 15:20:28,999] [INFO] 🧹 已清理客户端 46cbd5c5-f087-4690-ada7-24294fdc09b1 的所有音频处理资源
[2025-08-21 15:20:28,999] [INFO] 🧹 客户端 46cbd5c5-f087-4690-ada7-24294fdc09b1 资源清理完成
[2025-08-21 15:20:29,000] [INFO] 🛑 服务器运行被取消
[2025-08-21 15:20:29,000] [INFO] ✅ 服务器运行完成
[2025-08-21 15:20:42,534] [INFO] ✅ 信号处理器设置完成
[2025-08-21 15:20:42,534] [INFO] 🔧 服务器管理器初始化完成
[2025-08-21 15:20:42,534] [INFO] 🔍 开始验证运行环境...
[2025-08-21 15:20:42,535] [INFO] ✅ 运行环境验证通过
[2025-08-21 15:20:42,535] [INFO] 🚀 正在启动WebRTC语音助手服务器...
[2025-08-21 15:20:42,535] [INFO] 🚀 正在启动WebRTC服务器 localhost:8765
[2025-08-21 15:20:42,539] [INFO] server listening on [::1]:8765
[2025-08-21 15:20:42,539] [INFO] server listening on 127.0.0.1:8765
[2025-08-21 15:20:42,539] [INFO] ✅ WebRTC服务器启动成功！
[2025-08-21 15:20:42,539] [INFO] 📍 监听地址: localhost:8765
[2025-08-21 15:20:42,539] [INFO] 💡 客户端可通过 webrtc_client.html 连接
[2025-08-21 15:20:42,539] [INFO] 🔄 等待客户端连接...
[2025-08-21 15:20:47,919] [INFO] connection open
[2025-08-21 15:20:47,920] [INFO] 🔌 新客户端连接: 71b93ae6-b69e-43f1-8a22-8c8dafbd5432
[2025-08-21 15:20:53,435] [INFO] ⏳ 音频数据不足，继续等待...
[2025-08-21 15:20:54,437] [INFO] ⏳ 音频数据不足，继续等待...
[2025-08-21 15:20:55,439] [INFO] ⏳ 音频数据不足，继续等待...
[2025-08-21 15:20:56,440] [INFO] ⏳ 音频数据不足，继续等待...
[2025-08-21 15:20:57,442] [INFO] ⏳ 音频数据不足，继续等待...
[2025-08-21 15:20:58,444] [INFO] ⏳ 音频数据不足，继续等待...
[2025-08-21 15:20:59,446] [INFO] ⏳ 音频数据不足，继续等待...
[2025-08-21 15:21:02,013] [INFO] 🎤 语音输入结束，开始ASR处理
[2025-08-21 15:21:02,014] [INFO] 🎯 开始ASR语音识别
[2025-08-21 15:21:02,014] [INFO] 📊 处理音频数据: 客户端 71b93ae6-b69e-43f1-8a22-8c8dafbd5432, 8 块, 16384 字节
[2025-08-21 15:21:02,016] [INFO] 🔍 开始语音识别处理
[2025-08-21 15:21:02,016] [INFO] 🔑 正在获取百度ASR访问令牌...
[2025-08-21 15:21:02,131] [INFO] ✅ 已成功获取ASR访问令牌
[2025-08-21 15:21:02,131] [INFO] 📤 发送ASR识别请求: 16384 字节
[2025-08-21 15:21:02,473] [INFO] 📤 JSON格式ASR请求完成，状态码: 200
[2025-08-21 15:21:02,474] [INFO] 📋 ASR响应解析完成: success.
[2025-08-21 15:21:02,474] [WARNING] ⚠️ ASR识别结果为空
[2025-08-21 15:21:02,567] [INFO] 📤 表单格式ASR请求完成，状态码: 200
[2025-08-21 15:21:02,567] [INFO] 📋 ASR响应解析完成: json read error.
[2025-08-21 15:21:02,567] [ERROR] ❌ ASR API返回错误: 错误码=3300, 错误信息=json read error.
[2025-08-21 15:21:02,567] [ERROR] ❌ 所有ASR请求格式都失败
[2025-08-21 15:21:02,567] [WARNING] ⚠️ 使用备用ASR方案
[2025-08-21 15:21:02,567] [INFO] ✅ 备用ASR完成: 我听到了您的声音，这是一个测试回复
[2025-08-21 15:21:02,568] [INFO] 🤖 处理LLM对话: 我听到了您的声音，这是一个测试回复
[2025-08-21 15:21:02,568] [INFO] 🤖 处理用户问题: 我听到了您的声音，这是一个测试回复...
[2025-08-21 15:21:03,022] [INFO] ✅ LLM回复生成成功: 收到测试，一切正常。...
[2025-08-21 15:21:03,024] [INFO] 🔊 开始生成TTS音频: 收到测试，一切正常。
[2025-08-21 15:21:03,024] [INFO] 🔊 开始TTS语音合成: 收到测试，一切正常。...
[2025-08-21 15:21:03,024] [INFO] 🔑 正在获取百度TTS访问令牌...
[2025-08-21 15:21:03,080] [INFO] ✅ 已成功获取TTS访问令牌
[2025-08-21 15:21:03,081] [INFO] 📤 发送TTS合成请求: 10 字符
[2025-08-21 15:21:03,331] [INFO] ✅ TTS合成成功: 87404 字节
[2025-08-21 15:21:03,339] [INFO] ✅ TTS音频生成完成: 87404 字节
[2025-08-21 15:21:08,284] [INFO] ⏳ 音频数据不足，继续等待...
[2025-08-21 15:21:09,285] [INFO] ⏳ 音频数据不足，继续等待...
[2025-08-21 15:21:10,287] [INFO] ⏳ 音频数据不足，继续等待...
[2025-08-21 15:21:11,289] [INFO] ⏳ 音频数据不足，继续等待...
[2025-08-21 15:21:12,941] [INFO] 🧹 已清理客户端 71b93ae6-b69e-43f1-8a22-8c8dafbd5432 的所有音频处理资源
[2025-08-21 15:21:12,941] [INFO] 🗑️ 已清除客户端 71b93ae6-b69e-43f1-8a22-8c8dafbd5432 的对话历史 (2 条)
[2025-08-21 15:21:12,941] [INFO] 🧹 客户端 71b93ae6-b69e-43f1-8a22-8c8dafbd5432 资源清理完成
[2025-08-21 15:21:15,885] [INFO] 🛑 收到信号: SIGINT
[2025-08-21 15:21:15,886] [INFO] 🛑 正在关闭服务器...
[2025-08-21 15:21:15,886] [INFO] ✅ 服务器已关闭
[2025-08-21 15:21:15,886] [INFO] 🛑 服务器运行被取消
[2025-08-21 15:21:15,887] [INFO] ✅ 服务器运行完成
