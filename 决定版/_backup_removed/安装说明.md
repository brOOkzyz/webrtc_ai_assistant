# ASR + LLM + TTS 语音对话系统 - 安装说明

## 🎯 安装概述

本系统是一个完整的语音对话系统，需要正确安装Python环境和相关依赖包。本指南将帮助您完成从零开始的完整安装过程。

## 📋 系统要求

### 硬件要求
- **CPU**: 双核以上处理器
- **内存**: 最少4GB，推荐8GB+
- **存储**: 最少1GB可用空间
- **音频**: 麦克风和音频输出设备

### 软件要求
- **操作系统**: Windows 10+, macOS 10.14+, Ubuntu 18.04+
- **Python版本**: Python 3.8+
- **网络**: 稳定的互联网连接

## 🚀 安装步骤

### 第一步：安装Python

#### Windows用户
1. 访问 [Python官网](https://www.python.org/downloads/)
2. 下载Python 3.8+版本
3. 运行安装程序，**重要**: 勾选"Add Python to PATH"
4. 验证安装：
   ```cmd
   python --version
   pip --version
   ```

#### macOS用户
1. 使用Homebrew安装（推荐）：
   ```bash
   brew install python@3.8
   ```
2. 或从官网下载安装包
3. 验证安装：
   ```bash
   python3 --version
   pip3 --version
   ```

#### Linux用户
1. Ubuntu/Debian:
   ```bash
   sudo apt update
   sudo apt install python3 python3-pip python3-venv
   ```
2. CentOS/RHEL:
   ```bash
   sudo yum install python3 python3-pip
   ```
3. 验证安装：
   ```bash
   python3 --version
   pip3 --version
   ```

### 第二步：创建虚拟环境（推荐）

#### Windows
```cmd
# 创建虚拟环境
python -m venv asr_llm_env

# 激活虚拟环境
asr_llm_env\Scripts\activate

# 验证激活
where python
```

#### macOS/Linux
```bash
# 创建虚拟环境
python3 -m venv asr_llm_env

# 激活虚拟环境
source asr_llm_env/bin/activate

# 验证激活
which python
```

### 第三步：安装依赖包

1. **确保在虚拟环境中**：
   ```bash
   # 命令提示符前应该有 (asr_llm_env)
   (asr_llm_env) C:\Users\username>
   ```

2. **升级pip**：
   ```bash
   pip install --upgrade pip
   ```

3. **安装依赖包**：
   ```bash
   pip install -r requirements.txt
   ```

4. **验证安装**：
   ```bash
   python -c "import pyaudio, speech_recognition, websocket, requests; print('所有依赖包安装成功！')"
   ```

### 第四步：配置API密钥

#### 1. 配置LLM服务
编辑 `config.py` 文件：
```python
# 替换为您的实际配置
API_KEY = "your_actual_api_key_here"
BASE_URL = "https://api.siliconflow.cn"  # 或其他服务商
DEFAULT_MODEL = "THUDM/glm-4-9b-chat"   # 或其他模型
```

#### 2. 配置百度语音服务
编辑 `baidu_tts_config.py` 文件：
```python
# 替换为您的百度云配置
TTS_APP_ID = "your_baidu_app_id"
TTS_API_KEY = "your_baidu_api_key"
TTS_SECRET_KEY = "your_baidu_secret_key"
```

编辑 `流式_副本2/const.py` 文件：
```python
# 替换为您的百度云配置
APPID = "your_baidu_app_id"
APPKEY = "your_baidu_app_key"
DEV_PID = "15372"  # 中文识别模型
```

### 第五步：测试安装

#### 1. 测试API连接
```bash
python test_api.py
```

#### 2. 测试TTS功能
```bash
python test_tts.py
```

#### 3. 测试ASR功能
```bash
python test_asr_fix.py
```

## 🔧 常见安装问题

### 问题1：pip安装失败
**症状**: `pip install` 命令失败
**解决方案**:
```bash
# 升级pip
python -m pip install --upgrade pip

# 使用国内镜像源
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/
```

### 问题2：pyaudio安装失败
**症状**: pyaudio安装时出现编译错误
**解决方案**:

#### Windows
```bash
# 使用预编译包
pip install pipwin
pipwin install pyaudio
```

#### macOS
```bash
# 先安装portaudio
brew install portaudio
pip install pyaudio
```

#### Linux
```bash
# 安装系统依赖
sudo apt-get install portaudio19-dev python3-pyaudio
pip install pyaudio
```

### 问题3：权限问题
**症状**: 安装时提示权限不足
**解决方案**:
```bash
# 使用用户安装模式
pip install --user -r requirements.txt

# 或使用sudo（Linux/macOS）
sudo pip install -r requirements.txt
```

### 问题4：Python版本不兼容
**症状**: 某些包要求特定Python版本
**解决方案**:
1. 确保使用Python 3.8+
2. 检查包的版本兼容性
3. 考虑使用conda环境管理

## 📱 启动系统

### 方式1：直接启动
```bash
python asr_llm_working.py
```

### 方式2：使用启动脚本

#### Windows
```cmd
start.bat
```

#### Linux/macOS
```bash
chmod +x start.sh
./start.sh
```

### 方式3：使用安全版本
```bash
chmod +x start_safe_fixed.sh
./start_safe_fixed.sh
```

## ✅ 安装验证

### 功能验证清单
- [ ] Python环境正常
- [ ] 所有依赖包安装成功
- [ ] API密钥配置正确
- [ ] 网络连接正常
- [ ] 音频设备工作正常
- [ ] 主程序可以启动
- [ ] 语音识别功能正常
- [ ] TTS播放功能正常
- [ ] LLM对话功能正常

### 性能测试
1. **响应速度测试**：
   - 语音识别延迟 < 2秒
   - TTS启动延迟 < 1秒
   - LLM响应延迟 < 5秒

2. **稳定性测试**：
   - 连续对话30分钟无错误
   - 打断功能正常工作
   - 错误恢复机制有效

## 🔒 安全配置

### 生产环境建议
1. **使用环境变量**：
   ```bash
   export API_KEY="your_api_key"
   export BAIDU_APP_ID="your_app_id"
   ```

2. **限制网络访问**：
   - 只允许必要的API服务访问
   - 使用防火墙限制端口访问

3. **定期更新**：
   ```bash
   pip install --upgrade -r requirements.txt
   ```

## 📞 技术支持

### 安装问题
如果遇到安装问题，请：
1. 检查系统要求是否满足
2. 查看错误日志信息
3. 尝试使用虚拟环境
4. 检查网络连接状态

### 配置问题
如果遇到配置问题，请：
1. 验证API密钥是否正确
2. 检查网络连接状态
3. 确认服务商服务状态
4. 查看配置文件格式

### 功能问题
如果遇到功能问题，请：
1. 运行测试脚本验证
2. 查看程序日志输出
3. 检查音频设备状态
4. 验证依赖包版本

---

## 🎉 安装完成

恭喜！您已经成功安装了ASR + LLM + TTS语音对话系统。

现在您可以：
1. 启动系统开始使用
2. 享受流畅的语音对话体验
3. 体验智能打断功能
4. 根据需要调整性能配置

**祝您使用愉快！** 🎯✨

如有任何问题，请参考故障排除部分或联系技术支持团队。
