# ASR + LLM + TTS 语音对话系统 - 客户交付版本

## 🎯 系统简介

这是一个完整的语音对话系统，集成了语音识别(ASR)、大语言模型(LLM)对话和语音合成(TTS)功能。系统支持实时语音检测、智能打断和流畅的对话体验，已修复所有已知问题，可以稳定运行。

## ✨ 核心特性

- 🎤 **实时语音识别** - 高精度中文语音识别
- 🤖 **智能对话** - 基于GLM-4的智能问答
- 🔊 **流式语音合成** - 自然流畅的中文语音
- 🚀 **智能打断** - 随时打断AI回答，无缝切换话题
- ⚡ **高性能** - 支持快速、平衡、稳定三种性能模式
- 🔧 **易于配置** - 详细的配置说明和启动脚本

## 🚀 快速开始

### 1. 环境要求
- **操作系统**: Windows 10+, macOS 10.14+, Ubuntu 18.04+
- **Python版本**: Python 3.8+
- **内存**: 最少4GB，推荐8GB+
- **网络**: 稳定的互联网连接

### 2. 安装依赖
```bash
pip install -r requirements.txt
```

### 3. 配置API密钥
编辑 `config.py` 文件，填入您的API密钥：
```python
API_KEY = "your_api_key_here"
BASE_URL = "your_api_base_url"
DEFAULT_MODEL = "your_model_name"
```

### 4. 启动系统
```bash
# 直接启动
python asr_llm_working.py

# 或使用启动脚本
./start.sh          # Linux/macOS
start.bat           # Windows
```

## 📋 使用说明

### 基本操作流程
1. **启动程序** - 运行主程序或启动脚本
2. **选择模式** - 选择"启动实时语音检测"
3. **系统校准** - 保持安静，系统自动校准麦克风
4. **开始对话** - 直接说话即可开始对话
5. **智能打断** - 在AI回答时直接说话即可打断

### 高级功能
- **连续对话** - 支持连续提问，无需重新启动
- **错误恢复** - 自动处理网络错误和API异常
- **性能调优** - 可调整TTS性能和语音检测参数

## ⚙️ 配置说明

### TTS性能模式
在 `tts_performance_config.py` 中可以选择：
- **FAST**: 优先响应速度，可能存在轻微音频重叠风险
- **BALANCED**: 平衡响应速度和稳定性（推荐）
- **STABLE**: 优先稳定性，响应速度较慢

### 语音检测参数
在 `voice_detection_config.py` 中可以调整：
- 能量阈值
- 语音检测敏感度
- 噪音过滤参数

## 🔧 故障排除

### 常见问题

#### 1. 麦克风无法识别
**症状**: 系统无法检测到语音输入
**解决方案**:
- 检查麦克风权限设置
- 确认音频设备正常工作
- 检查麦克风是否被其他程序占用

#### 2. TTS播放异常
**症状**: 没有声音输出或声音异常
**解决方案**:
- 检查网络连接状态
- 验证百度云TTS配置
- 确认音频输出设备正常

#### 3. LLM响应慢
**症状**: AI回答速度很慢
**解决方案**:
- 检查API密钥配置
- 验证网络连接状态
- 检查API服务状态

#### 4. 语音识别不准确
**症状**: 识别结果错误较多
**解决方案**:
- 减少背景噪音
- 说话更清晰
- 调整语音检测参数

### 调试方法
1. **查看日志输出** - 程序包含详细的调试信息
2. **使用测试工具** - 运行 `test_*.py` 脚本验证功能
3. **检查网络状态** - 确认API服务访问正常
4. **验证配置** - 检查API密钥和配置文件

## 📁 文件结构

```
项目根目录/
├── 🎯 核心程序/
│   ├── asr_llm_working.py      # 主程序（已修复所有问题）
│   ├── config.py                # 主配置文件
│   └── requirements.txt         # 依赖包列表
│
├── 🔧 功能模块/
│   ├── tts_streaming.py        # TTS流式播放模块
│   ├── tts_module_baidu_final.py # 百度TTS集成模块
│   └── 流式_副本2/             # 百度ASR模块
│
├── ⚙️ 配置文件/
│   ├── tts_performance_config.py # TTS性能配置
│   ├── baidu_tts_config.py      # 百度TTS配置
│   └── voice_detection_config.py # 语音检测配置
│
├── 🚀 启动脚本/
│   ├── start.sh                 # Linux/macOS启动
│   ├── start.bat                # Windows启动
│   └── start_safe_fixed.sh      # 安全版本启动
│
├── 🧪 测试工具/
│   ├── test_tts_overlap_fix.py # TTS重叠问题测试
│   ├── test_http_connection_interrupt.py # HTTP连接中断测试
│   └── test_api.py              # API连接测试
│
└── 📚 文档说明/
    ├── README.md                # 主要说明文档
    ├── 交付说明.md              # 交付说明
    ├── 项目打包清单.md          # 项目清单
    └── TTS_OVERLAP_FIX_README.md # TTS问题修复说明
```

## 🔒 安全说明

- **API密钥安全**: 请妥善保管API密钥，不要泄露
- **环境变量**: 建议在生产环境中使用环境变量
- **网络访问**: 确保网络环境安全，定期更新依赖包
- **权限管理**: 根据需要限制系统访问权限

## 📈 性能优化

### 响应速度优化
- 使用快速模式可提高TTS响应速度
- 调整语音检测参数可优化识别准确率
- 网络优化可提升整体性能

### 稳定性优化
- 使用稳定模式可提高系统稳定性
- 定期检查API服务状态
- 监控系统资源使用情况

## 🎉 系统优势

### 技术优势
1. **问题解决** - 修复了TTS重叠、内容混合等关键问题
2. **性能优化** - 提供了多种性能配置选项
3. **智能打断** - 支持实时语音打断，无缝切换话题
4. **错误恢复** - 自动处理网络错误和API异常

### 使用优势
1. **易于使用** - 简单的语音交互，无需学习复杂操作
2. **功能完整** - 集成了ASR、LLM、TTS的完整功能
3. **跨平台** - 支持Windows、macOS、Linux
4. **文档齐全** - 包含详细的使用说明和故障排除

## 📞 技术支持

### 自助支持
1. 查看详细文档说明
2. 参考故障排除指南
3. 使用测试工具验证功能
4. 检查日志输出信息

### 问题报告
如遇到问题，请提供：
1. 错误日志信息
2. 系统环境信息
3. 问题复现步骤
4. 期望的正确行为

## 🔄 更新说明

### 当前版本: v2.0.0
- ✅ 修复TTS音频重叠问题
- ✅ 修复LLM内容混合问题
- ✅ 修复HTTP连接中断问题
- ✅ 优化打断检测延迟
- ✅ 新增性能配置选项
- ✅ 增强错误处理机制

### 后续更新
- 定期修复已知问题
- 持续优化性能
- 增加新功能特性
- 改进用户体验

---

## 🎯 开始使用

现在您可以：
1. 按照安装说明配置系统
2. 运行测试脚本验证功能
3. 开始享受流畅的语音对话体验

**祝您使用愉快！** 🎉✨

如有任何问题，请参考文档或联系技术支持团队。
