# ASR + LLM + TTS 语音对话系统 - 交付说明

## 🎯 项目概述

这是一个完整的语音对话系统，集成了语音识别(ASR)、大语言模型(LLM)对话和语音合成(TTS)功能。系统支持实时语音检测、智能打断和流畅的对话体验。

## ✨ 核心功能

### 1. **语音识别 (ASR)**
- 实时语音检测和识别
- 支持百度云ASR API
- 智能噪音过滤和音频质量检测
- 自动重试和错误处理

### 2. **大语言模型对话 (LLM)**
- 支持多种LLM API（GLM-4、OpenAI等）
- 流式响应处理
- 智能打断检测和处理
- 上下文管理和状态清理

### 3. **语音合成 (TTS)**
- 百度云流式TTS
- 实时音频播放
- 智能打断和音频重叠防护
- 可配置的性能模式

### 4. **智能打断系统**
- 实时语音打断检测
- 立即停止TTS播放
- 清理LLM响应状态
- 无缝启动新对话

## 📦 交付内容

### 核心文件
- `asr_llm_working.py` - 主程序文件（已修复所有问题）
- `config.py` - 配置文件
- `requirements.txt` - 依赖包列表

### 模块文件
- `tts_streaming.py` - TTS流式播放模块
- `tts_module_baidu_final.py` - 百度TTS集成模块
- `流式_副本2/` - 百度ASR WebSocket模块

### 配置文件
- `tts_performance_config.py` - TTS性能配置
- `baidu_tts_config.py` - 百度TTS配置
- `voice_detection_config.py` - 语音检测配置

### 文档文件
- `README.md` - 主要说明文档
- `TTS_OVERLAP_FIX_README.md` - TTS问题修复说明
- `PROJECT_SUMMARY.md` - 项目总结
- `安装说明.md` - 详细安装指南

### 测试文件
- `test_tts_overlap_fix.py` - TTS重叠问题测试
- `test_http_connection_interrupt.py` - HTTP连接中断测试
- `test_api.py` - API连接测试

### 启动脚本
- `start.sh` - Linux/macOS启动脚本
- `start.bat` - Windows启动脚本
- `start_safe_fixed.sh` - 安全版本启动脚本

## 🚀 快速开始

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 配置API密钥
编辑 `config.py` 文件，填入您的API密钥：
```python
API_KEY = "your_api_key_here"
BASE_URL = "your_api_base_url"
DEFAULT_MODEL = "your_model_name"
```

### 3. 运行程序
```bash
python asr_llm_working.py
```

## ⚙️ 系统要求

- **操作系统**: Windows 10+, macOS 10.14+, Ubuntu 18.04+
- **Python版本**: Python 3.8+
- **内存**: 最少4GB，推荐8GB+
- **存储**: 最少1GB可用空间
- **网络**: 稳定的互联网连接

## 🔧 配置说明

### TTS性能模式
在 `tts_performance_config.py` 中可以选择：
- **FAST**: 优先响应速度，可能存在轻微音频重叠风险
- **BALANCED**: 平衡响应速度和稳定性（推荐）
- **STABLE**: 优先稳定性，响应速度较慢

### 语音检测参数
在 `voice_detection_config.py` 中可以调整：
- 能量阈值
- 语音检测敏感度
- 噪音过滤参数

## 📋 使用说明

### 基本操作
1. 启动程序后选择"启动实时语音检测"
2. 系统会自动校准麦克风
3. 直接说话即可开始对话
4. 可以随时打断AI回答，开始新话题

### 高级功能
- **打断模式**: 在AI说话时直接说话即可打断
- **连续对话**: 支持连续提问，无需重新启动
- **错误恢复**: 自动处理网络错误和API异常

## 🐛 问题排查

### 常见问题
1. **麦克风无法识别**: 检查麦克风权限和音频设备
2. **TTS播放异常**: 检查网络连接和百度云配置
3. **LLM响应慢**: 检查API密钥和网络状态

### 调试模式
程序包含详细的调试信息输出，可以帮助诊断问题。

## 📞 技术支持

如有问题，请检查：
1. 日志输出信息
2. 网络连接状态
3. API密钥配置
4. 系统依赖安装

## 🔒 安全说明

- API密钥请妥善保管，不要泄露
- 建议在生产环境中使用环境变量
- 定期更新依赖包以修复安全漏洞

## 📈 性能优化

- 使用快速模式可提高响应速度
- 调整语音检测参数可优化识别准确率
- 网络优化可提升整体性能

## 🎉 交付完成

本系统已经过全面测试和优化，修复了所有已知问题：
- ✅ TTS音频重叠问题
- ✅ LLM内容混合问题
- ✅ HTTP连接中断问题
- ✅ 打断检测延迟问题

系统现在可以稳定运行，提供流畅的语音对话体验！
