# WebRTC语音助手系统 - 安装说明

## 🚀 快速安装

### 1. 环境检查

#### Python环境
```bash
# 检查Python版本 (需要3.8+)
python3 --version

# 如果没有Python，请先安装
# macOS: brew install python3
# Ubuntu: sudo apt install python3 python3-pip
# Windows: 从python.org下载安装包
```

#### 网络环境
- 确保能访问互联网
- 防火墙允许8765端口
- 支持HTTPS请求

### 2. 依赖安装

#### 自动安装 (推荐)
```bash
# 安装Python依赖包
pip3 install -r requirements.txt
```

#### 手动安装
```bash
# 核心依赖
pip3 install websockets
pip3 install requests
pip3 install asyncio

# 可选依赖 (用于音频处理)
pip3 install wave
pip3 install numpy
```

### 3. 配置设置

#### API密钥配置
编辑 `config.py` 文件：
```python
# 你的LLM API密钥
API_KEY = "YOUR API KEY"

# API服务地址
BASE_URL = "https://api.siliconflow.cn"

# 使用的模型
DEFAULT_MODEL = "THUDM/glm-4-9b-chat"
```

#### 百度API配置 (已预配置)
```python
# ASR配置
APPID = "YOUR APP ID"
API_KEY = "YOUR API KEY"
SECRET_KEY = "YOUR SECRET KEY"

# TTS配置
TTS_API_KEY = "YOUR API KEY"
TTS_SECRET_KEY = "YOUR SECRET KEY"
```

## 🎯 启动系统

### 方法1: 使用启动脚本 (推荐)

#### Linux/macOS
```bash
# 给脚本执行权限
chmod +x start_webrtc_server.sh

# 启动服务端
./start_webrtc_server.sh
```

#### Windows
```cmd
# 双击运行
start_webrtc_server.bat

# 或在命令行运行
start_webrtc_server.bat
```

### 方法2: 手动启动

#### 启动服务端
```bash
# 直接运行Python脚本
python3 webrtc_server.py
```

#### 启动客户端
```bash
# 在浏览器中打开
open webrtc_client.html
# 或双击文件
```

## 🔧 系统配置

### 端口配置
默认端口：8765
如需修改，编辑 `webrtc_server.py`：
```python
class WebRTCServer:
    def __init__(self, host='localhost', port=8765):  # 修改端口号
```

### 音频配置
- **采样率**: 16000Hz
- **声道**: 单声道
- **格式**: 16位PCM
- **缓冲区**: 2048字节

### 语音检测配置
- **音量阈值**: 0.015 (可调节)
- **连续帧数**: 2帧
- **等待时间**: 2秒

## 📱 使用说明

### 1. 启动系统
1. 运行服务端脚本
2. 在浏览器中打开客户端
3. 点击"连接服务器"
4. 允许麦克风权限

### 2. 开始对话
1. 点击"开始录音"按钮
2. 说出你的问题
3. 等待AI回复
4. 继续对话或停止录音

### 3. 功能特性
- **智能语音检测**: 自动过滤背景噪音
- **完整语音捕获**: 避免语音分段
- **实时对话**: 低延迟响应
- **高质量TTS**: 自然语音输出

## 🚨 故障排除

### 常见问题

#### 1. 端口被占用
```bash
# 检查端口占用
lsof -i :8765  # macOS/Linux
netstat -an | findstr 8765  # Windows

# 结束占用进程
kill -9 <PID>
```

#### 2. 依赖包安装失败
```bash
# 升级pip
pip3 install --upgrade pip

# 使用国内镜像
pip3 install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/
```

#### 3. 麦克风权限问题
- 检查浏览器麦克风权限
- 确保系统麦克风可用
- 尝试刷新页面重新授权

#### 4. 网络连接问题
- 检查防火墙设置
- 确认8765端口开放
- 测试网络连通性

### 日志分析
```bash
# 查看服务端日志
tail -f webrtc_server.log

# 查看客户端控制台
# 在浏览器中按F12打开开发者工具
```

## 📞 技术支持

### 联系信息
- **技术文档**: 参考各.md文件
- **问题反馈**: 查看系统日志
- **功能建议**: 记录在需求文档中

### 系统维护
- 定期检查API密钥有效性
- 监控系统性能和稳定性
- 备份重要配置文件

---
**安装完成！** 🎉  
现在你可以享受完整的WebRTC语音助手系统了！
